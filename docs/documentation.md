Getting started
===

Installation
---

Dive can be installed with [Composer](http://www.getcomposer.org).

Add the following requirement in your ``composer.json`` file:

```js
{
    "require": {
        "sigma-z/dive": "*"
    }
}
```

Call ``composer install`` from your command line to add ``Dive`` to your ``vendor`` folder.
If you don't know how Composer works, please check out
their [Getting Started](http://getcomposer.org/doc/00-intro.md) to set up.

Configure database connection
---

To work with Dive the connection details have to be defined


Import database schema
---

Dive needs to know about your database details (tables and their columns, relations and indexes, views).
See also [Section Schema](#schema).

To import the schema from an existing database you can execute a console command on the cli.

```bash
$> php ./cli/dive.php importSchema /path/to/schema.php
```

See also [Section Command importSchema](#command-importschema)


Creating record classes (Models)
---

To generate record classes as the model layer you can run the console command [generateModels](#command-generatemodels).

```bash
$> php ./cli/dive.php generateModels /path/to/schema.php /path/to/models-dir
```

Note: You do not need to create a model class for each table. In fact, no model class will be
generated by a fresh imported schema. Define specific model classes by adding the key ``recordClass``
for tables, that should have a specific record class.

You have specific needs and want to extend from another base class instead of ``\Dive\Record``?
You can do this by added the key ``baseRecordClass`` to your schema.

See also [Section Schema](#schema).


Working with record objects
---

Querying tables
---




Schema
===

In short
---

This is a short overview of the Dive schema definition.

```php
<?php
return array(
    'tables' => array(
        'table_name' => array(
            'fields' => array(
                'id_field' => array(
                    'primary'   => true,
                    'type' => 'integer'
                ),
                /* and more */
            ),
            'behaviours' => array(),
            'validators' => array()
        ),
        /* and more */
    ),
    'views' => array(
        'view_name' => array(
            'fields' => array(
                'id_field' => array(
                    'type' => 'integer'
                ),
                /* and more */
            )
        ),
        /* and more */
    ),
    'relations' => array(
        'table_with_fk.fk_field' => array(
            'owningAlias' => 'TableWithFk',
            'owningField' => 'fk_field',
            'owningTable' => 'table_with_fk',
            'refAlias' => 'TableRef',
            'refField' => 'id',
            'refTable' => 'table_ref',
            'type' => '1-m',
            'onUpdate' => 'CASCADE',
            'onDelete' => 'CASCADE'
        ),
        /* and more */
    ),
    'baseRecordClass' => '\\Your\\Custom\\BaseRecordClass',
    'baseTableClass' => '\\Your\\Custom\\BaseTableClass'
);
```

Tables and Views
---

Tables were defined by the key ``tables``, view by the key ``views``.

Their fields is the sub-key ``fields``.

More about fields and their data types see [next section](#field-types-vs-database-column-types).


Field types vs database column types
---

If you importing Dive schema from an existing database Dive maps the table/view columns to their best fitting
Dive field types. By saving a record the field values will be validated by their specific types.

Read more about how database column types are mapped into dive field types
in section [Data type mapper](#data-type-mapper).

The field type is defined by the key ``type``. Here an example for a primary key definition.

```php
'id' => array(
    'type' => 'integer',
    'primary' => true,
    'autoIncrement' => true,
    'unsigned' => true
)
```

Attributes, that are applicable to most field types, are:

 - (bool)``primary`` - Default: FALSE
 - (bool)``autoIncrement`` - Default: FALSE (effective if ``primary`` is TRUE)
 - (bool)``nullable`` - Default: FALSE
 - (string)``default`` - Default value for new records


### Boolean

type: ``boolean``

### Integer

type: ``integer``

Attributes applicable:

 - (bool)``unsigned`` - Default: FALSE
 - (int)``length`` - value length
 - (bool)``zerofill`` - Flag, whether integer is zero-filled or not (Applies only to mysql database)


### Double

type: ``double``

Attributes applicable:

 - (bool)``unsigned`` - Default: FALSE
 - (int)``length`` - value length


### Decimal

type: ``decimal``

Attributes applicable:

 - (bool)``unsigned`` - Default: FALSE
 - (int)``length`` - value length (precision = length - 1)
 - (int)``scale`` digits after comma


### String

type: ``string``

Attributes applicable:

 - (int)``length`` - value length


### Datetime

type: ``datetime``

Datetime field type has the format: ``YYYY-MM-DD hh:mm:ss``.


### Date

type: ``date``

Date field type has the format: ``YYYY-MM-DD``.


### Time

type: ``time``

Time field type has the format: ``hh:mm:ss``.


### Timestamp

type: ``timestamp``

Represents a unix timestamp.


### Blob

type: ``blob``

Binary large objects are handled as large strings.


### Enum

type: ``enum``

The enum field can be used with or without support of your database management system.
That means the Dive enum field can by a varchar in your database and Dive handles the
validation of the values set to the enum field.

Attributes applicable:

 - (array)``values`` - Accepted values


Foreign key relations
---------------------

Indexes
-------

Behaviours
----------

Validators
----------


Console
===

Common tasks, like schema imports or model generation, can be executed by the console functionality of Dive.

Prints help for usage of the Dive concole:

```bash
$> php ./cli/dive.php help
```

Prints help for usage of specified command:

```bash
$> php ./cli/dive.php help <command name>
```

If you like, you can write your own commands, see [Creating custom commands](#creating-custom-commands)


Dive commands
---

### Command importSchema

Required params:

 - ``schema-file``:     Output file for Dive schema

Imports the schema from a database into a schema-file, built in php.

```bash
$> php ./cli/dive.php importSchema /path/to/schema.php
```

### Command generateModels

Required Params:

 - ``schema-file``:        Dive schema file (php)
 - ``target-dir``:         Target directory for model classes

Optional params:

 - ``overwrite``:          Flag to overwrite existing model classes, default if OFF
 - ``license-file``:       License text read from file will be the license comment in generated model classes
 - ``eol``:                Possible values: lf crlf cr (default is lf)
 - ``create-date-format``: Default is d.m.y

Generates record classes as the model layer.

```bash
$> php ./cli/dive.php generateModels /path/to/models-dir
```

Creating custom commands
---

Writing your own command class is easy, just

- Create a class and extend from ``\Dive\Console\Command\Command``
  (Note: the class name is the name of the command without suffix 'Command')
- Set properties ``description``, ``requiredParams`` and ``optionalParams``
- Implement ``execute()``

Sample code for custom command with name **sample**:

```php
<?php
use Dive\Console\Command\Command;

class SampleCommand extends Command
{
    public function __construct()
    {
        $this->description = 'This is a sample command';
        $this->requiredParams = array(
            'paramOne' => 'Description of required param paramOne'
        );
        $this->optionalParams = array(
            'paramTwo' => 'Description of optional param paramTwo'
        );
    }

    public function execute(OutputWriterInterface $outputWriter)
    {
        $outputWriter->writeLine('paramOne: ' . $this->getParam('paramOne'));
        $outputWriter->writeLine('paramTwo: ' . $this->getParam('paramTwo'));
        return true;
    }
}
```

Relations
===

Working with records
===

Validation
===

Behaviours
===

Migration
===

Data type mapper
===
